<ion-content class="bg-light">
  <div id="header" class="bg-gradient-to-br from-red-500 to-yellow-500 text-white rounded-bottom d-flex flex-column"
    style="height: 50%;">
    <div id="app-bar" class="d-flex justify-content-between align-items-center px-3" style="height: 60px;">
      <ion-icon name="arrow-back" style="font-size: 24px;"></ion-icon>
    </div>

    <div id="logo" class="bg-white rounded d-flex justify-content-center align-items-center mx-auto mt-5"
      style="width: 100px; height: 100px;">
      <img src="assets/logo.png" alt="Logo" class="img-fluid" style="width: 70%;" />
    </div>

    <h2 class="text-center fw-bold mt-2" style="font-size: 20px; letter-spacing: 1px;">PIZZADAY</h2>
  </div>

  <div class="card mx-3 position-absolute start-0 end-0" style="top: 37%; border-radius: 20px; box-shadow: none;">
    <div class="card-body px-4 py-4 text-center">

      <div class="mb-3">
        <h1 class="fw-bold fs-5 mb-1">Seja Bem-vindo(a)</h1>
        <p class="text-muted">Configure colaborativamente dentro da sala</p>
      </div>

      <form [formGroup]="loginForm" (ngSubmit)="joinSession()">
        <div class="mb-4">
          <label for="cpfInput" class="block text-gray-700 text-lg font-medium mb-2">
            <ion-icon name="person" class="me-2"></ion-icon>
            CPF:
          </label>
          <input id="cpfInput" formControlName="cpf" class="form-control" placeholder="Ex: 99999999999" type="number" />
          <div *ngIf="loginForm.get('cpf')?.invalid && (loginForm.get('cpf')?.dirty || loginForm.get('cpf')?.touched)" class="text-danger text-sm mt-1">
            <span *ngIf="loginForm.get('cpf')?.errors?.['required']">CPF √© obrigat√≥rio.</span>
            <span *ngIf="loginForm.get('cpf')?.errors?.['pattern']">CPF deve ter 11 d√≠gitos num√©ricos.</span>
          </div>
        </div>

        <div class="mb-4">
          <label for="nomeInput" class="text-gray-700 text-lg font-medium">
            <ion-icon name="person-circle" class="me-2"></ion-icon>
            Nome:
          </label>
          <input id="nomeInput" formControlName="nome" type="text" class="form-control mb-3" placeholder="Ex: Jo√£o Pedro" [readonly]="nomeCarregado">
          <div *ngIf="loginForm.get('nome')?.invalid && (loginForm.get('nome')?.dirty || loginForm.get('nome')?.touched)" class="text-danger text-sm mt-1">
            <span *ngIf="loginForm.get('nome')?.errors?.['required']">Nome √© obrigat√≥rio.</span>
          </div>
        </div>

        <div class="mb-4">
          <label for="sessionIdInput" class="text-gray-700 text-lg font-medium">
            <ion-icon name="home" class="me-2"></ion-icon>
            ID da Confraterniza√ß√£o:
          </label>
          <input id="sessionIdInput" [class.animate-popIn]="animatePop" formControlName="sessionId" type="text"
            class="form-control mb-3" placeholder="Ex: pizza-day-123">
            <div *ngIf="loginForm.get('sessionId')?.invalid && (loginForm.get('sessionId')?.dirty || loginForm.get('sessionId')?.touched)" class="text-danger text-sm mt-1">
              <span *ngIf="loginForm.get('sessionId')?.errors?.['required']">ID da sess√£o √© obrigat√≥ria.</span>
              <span *ngIf="loginForm.get('sessionId')?.errors?.['minlength']">ID da sess√£o deve ter no m√≠nimo 8 caracteres.</span>
            </div>
        </div>

        <button type="submit"
          class="w-full bg-red-600 text-white px-6 rounded-xl text-lg font-semibold hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-200 shadow-md hover:shadow-lg mb-3"
          style="height: 45px;"
          [disabled]="loginForm.invalid"> 
          <ion-icon name="enter" class="me-2"></ion-icon>
          Entrar na Sala
        </button>
      </form>

      <button (click)="generateId()"
        class="w-full h-12 text-base rounded-xl font-medium border-2 border-red-600 text-red-600 hover:bg-red-600 hover:text-white transition duration-200 ease-in-out mb-3">
        <ion-icon name="dice" class="me-2"></ion-icon>
        Gerar ID R√°pido para Nova Sala
      </button>

      <!-- Info Box sobre Configura√ß√£o Colaborativa -->
      <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4 rounded-r-lg">
        <div class="flex items-start">
          <ion-icon name="information-circle" class="text-blue-400 mr-2 text-xl mt-1"></ion-icon>
          <div class="text-left">
            <p class="text-blue-800 text-sm font-semibold mb-1">üí° Dica:</p>
            <p class="text-blue-700 text-sm">
              Todos os <strong>hosts</strong> podem configurar o valor da pizza e tipo de divis√£o 
              diretamente dentro da sala. As mudan√ßas s√£o aplicadas em tempo real!
            </p>
          </div>
        </div>
      </div>

      <div class="line-text position-relative mt-4" style="height: 20px;">
        <span class="lines position-absolute top-50 start-0 w-100 border-top border-secondary"></span>
        <span
          class="text position-absolute top-50 start-50 translate-middle bg-white px-3 fs-8 fw-semibold text-secondary">
          Ou conectar usando
        </span>
      </div>

      <div class="mt-3">
        <button [disabled]="loginForm.get('cpf')?.invalid" (click)="showScanner = !showScanner" 
          class="btn btn-outline-warning mt-2 d-flex align-items-center justify-content-center mx-auto">
          <ion-icon [name]="showScanner ? 'close' : 'qr-code-outline'" class="me-2"></ion-icon>
          {{ showScanner ? 'Fechar Scanner' : 'Escanear QR Code' }}
        </button>

        <div *ngIf="showScanner" class="mt-3">
          <zxing-scanner (scanSuccess)="onCodeResult($event)" [torch]="false" [formats]="barcodeFormats"
            style="width: 100%; height: 200px; border: 2px dashed #f59e0b; border-radius: 10px;">
          </zxing-scanner>
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger mt-3 p-2 text-center" role="alert">
        <ion-icon name="alert-circle" class="me-2"></ion-icon>
        {{ errorMessage }}
      </div>
    </div>
  </div>
</ion-content>